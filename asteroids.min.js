(function(){function u(){function i(a,b){if(typeof a=="Object"){this.x=a.x;this.y=a.y}else{this.x=a;this.y=b}}function n(a,b){this.p1=a;this.p2=b}function v(){for(var a=0,b;b=e.enemies[a];a++)r(b,"ASTEROIDSYEAHENEMY");b=document.body.getElementsByTagName("*");e.enemies=[];a=0;for(var c;c=b[a];a++)if(l(w,c.tagName.toUpperCase())==-1&&c.prefix!="g_vml_"&&x(c)&&c.className!="ASTEROIDSYEAH"&&c.offsetHeight>0){var g=c,f=0,h=0;do{f+=g.offsetLeft||0;h+=g.offsetTop||0;g=g.offsetParent}while(g);c.aSize={x:f,
y:h,width:c.offsetWidth||10,height:c.offsetHeight||10};e.enemies.push(c);p(c,"ASTEROIDSYEAHENEMY");if(!c.aAdded){c.aAdded=true;e.totalEnemies++}}}function d(a){var b={up:38,down:40,left:37,right:39,esc:27};if(b[a])return b[a];return a.charCodeAt(0)}function o(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent){a["e"+b+c]=c;a[b+c]=function(){a["e"+b+c](window.event)};a.attachEvent("on"+b,a[b+c])}}function q(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);
else if(a.detachEvent){a.detachEvent("on"+b,a[b+c]);a[b+c]=null;a["e"+b+c]=null}}function y(a){for(var b=(new Date).getTime(),c=M,g=0;g<c;g++)e.particles.push({dir:(new i(Math.random()*20-10,Math.random()*20-10)).normalize(),pos:a.cp(),cameAlive:b})}function z(){e.points.innerHTML=e.enemiesKilled*10;e.points.title=e.enemiesKilled+"/"+e.totalEnemies;window.ASTEROIDS.enemiesKilled=e.enemiesKilled}function x(a){if(l(A,a.tagName)!=-1)return false;if(a.offsetWidth==0&&a.offsetHeight==0)return false;for(var b=
0;b<a.childNodes.length;b++)if(a.childNodes[b].nodeType!=3&&l(A,a.childNodes[b].tagName)==-1&&a.childNodes[b].childNodes.length!=0)return false;return true}function l(a,b,c){if(a.indexOf)return a.indexOf(b,c);var g=a.length;for(c=c<0?Math.max(0,g+c):c||0;c<g;c++)if(a[c]===b)return c;return-1}function p(a,b){if(a.className.indexOf(b)==-1)a.className=(a.className+" "+b).replace(/\s+/g," ").replace(/^\s+|\s+$/g,"")}function r(a,b){a.className=a.className.replace(new RegExp("(^|\\s)"+b+"(?:\\s|$)"),"$1")}
function B(){q(document,"keydown",C);q(document,"keypress",D);q(document,"keyup",E);q(window,"resize",F);N=false;var a=document.getElementById("ASTEROIDSYEAH");a&&a.parentNode.removeChild(a);r(document.body,"ASTEROIDSYEAH");this.gameContainer.parentNode.removeChild(this.gameContainer)}if(!window.ASTEROIDS)window.ASTEROIDS={enemiesKilled:0};i.prototype={cp:function(){return new i(this.x,this.y)},mul:function(a){this.x*=a;this.y*=a;return this},mulNew:function(a){return new i(this.x*a,this.y*a)},add:function(a){this.x+=
a.x;this.y+=a.y;return this},addNew:function(a){return new i(this.x+a.x,this.y+a.y)},sub:function(a){this.x-=a.x;this.y-=a.y;return this},subNew:function(a){return new i(this.x-a.x,this.y-a.y)},rotate:function(a){var b=this.x,c=this.y;this.x=b*Math.cos(a)-Math.sin(a)*c;this.y=b*Math.sin(a)+Math.cos(a)*c;return this},rotateNew:function(a){return this.cp().rotate(a)},setAngle:function(a){var b=this.len();this.x=Math.cos(a)*b;this.y=Math.sin(a)*b;return this},setAngleNew:function(a){return this.cp().setAngle(a)},
setLength:function(a){var b=this.len();if(b)this.mul(a/b);else this.x=this.y=a;return this},setLengthNew:function(a){return this.cp().setLength(a)},normalize:function(){var a=this.len();this.x/=a;this.y/=a;return this},normalizeNew:function(){return this.cp().normalize()},angle:function(){return Math.atan2(this.y,this.x)},collidesWith:function(a){return this.x>a.x&&this.y>a.y&&this.x<a.x+a.width&&this.y<a.y+a.height},len:function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<0.0050&&a>-0.0050)return 0;
return a},is:function(a){return typeof a=="object"&&this.x==a.x&&this.y==a.y},toString:function(){return"[Vector("+this.x+", "+this.y+") angle: "+this.angle()+", length: "+this.len()+"]"}};n.prototype={shift:function(a){this.p1.add(a);this.p2.add(a)},intersectsWithRect:function(a){var b=new i(a.x,a.y+a.height),c=new i(a.x,a.y),g=new i(a.x+a.width,a.y+a.height);a=new i(a.x+a.width,a.y);if(this.p1.x>b.x&&this.p1.x<a.x&&this.p1.y<b.y&&this.p1.y>a.y&&this.p2.x>b.x&&this.p2.x<a.x&&this.p2.y<b.y&&this.p2.y>
a.y)return true;if(this.intersectsLine(new n(c,b)))return true;if(this.intersectsLine(new n(b,g)))return true;if(this.intersectsLine(new n(c,a)))return true;if(this.intersectsLine(new n(a,g)))return true;return false},intersectsLine:function(a){var b=this.p1,c=this.p2,g=a.p1,f=a.p2;a=(f.y-g.y)*(c.x-b.x)-(f.x-g.x)*(c.y-b.y);if(a==0)return false;f=((f.x-g.x)*(b.y-g.y)-(f.y-g.y)*(b.x-g.x))/a;b=((c.x-b.x)*(b.y-g.y)-(c.y-b.y)*(b.x-g.x))/a;return f>=0&&f<=1&&b>=0&&b<=1}};var e=this,k=document.documentElement.clientWidth,
j=document.documentElement.clientHeight,G=[[-15,-10],[-15,10],[15,0]],w=["HTML","HEAD","BODY","SCRIPT","TITLE","CANVAS","META","STYLE","LINK","SHAPE","LINE","GROUP","IMAGE","STROKE","FILL","SKEW","PATH","TEXTPATH"],A=["BR","HR"],H=window.ActiveXObject?30:50,M=40;this.enemiesKilled=parseInt(window.ASTEROIDS.enemiesKilled,10);this.flame={r:[],y:[]};this.toggleBlinkStyle=function(){this.updated.blink.isActive?r(document.body,"ASTEROIDSBLINK"):p(document.body,"ASTEROIDSBLINK");this.updated.blink.isActive=
!this.updated.blink.isActive};(function(a,b){var c=document.getElementById(a);if(!c){c=document.createElement("style");c.type="text/css";c.rel="stylesheet";c.id=a;document.getElementsByTagName("head")[0].appendChild(c)}c.innerHTML+=b})("ASTEROIDSYEAH",".ASTEROIDSBLINK .ASTEROIDSYEAHENEMY { outline: 2px dotted red; }");this.pos=new i(100,100);this.lastPos=false;this.vel=new i(0,0);this.dir=new i(0,1);this.keysPressed={};this.firedAt=false;this.updated={enemies:false,flame:(new Date).getTime(),blink:{time:0,
isActive:false}};this.scrollPos=new i(0,0);this.bullets=[];this.enemies=[];this.dying=[];this.totalEnemies=0;this.particles=[];v();var s;(function(){var a=12*0.2;s=function(){e.flame.r=[[-15,-10]];e.flame.y=[[-15,-6]];for(var b=0;b<20;b+=2)e.flame.r.push([-Math.floor(Math.random()*8+2)-15,b-10]);e.flame.r.push([-15,10]);for(b=0;b<12;b+=a)e.flame.y.push([-Math.floor(Math.random()*8+2)-15,b-6]);e.flame.y.push([-15,6])}})();s();this.gameContainer=document.createElement("div");this.gameContainer.className=
"ASTEROIDSYEAH";this.canvas=document.createElement("canvas");this.canvas.setAttribute("width",k);this.canvas.setAttribute("height",j);this.canvas.className="ASTEROIDSYEAH";with(this.canvas.style){width=k+"px";height=j+"px";position="fixed";right=bottom=left=top="0px";zIndex="10000"}if(typeof G_vmlCanvasManager!="undefined"){this.canvas=G_vmlCanvasManager.initElement(this.canvas);this.canvas.getContext||alert("So... you're using IE?  Please join me at http://github.com/erkie/erkie.github.com if you think you can help")}else this.canvas.getContext||
alert("This program does not yet support your browser. Please join me at http://github.com/erkie/erkie.github.com if you think you can help");o(this.canvas,"mousedown",function(){B.apply(e)});var F=function(){k=document.documentElement.clientWidth;j=document.documentElement.clientHeight;e.canvas.setAttribute("width",k);e.canvas.setAttribute("height",j)};o(window,"resize",F);this.gameContainer.appendChild(this.canvas);this.ctx=this.canvas.getContext("2d");this.ctx.fillStyle="black";this.ctx.strokeStyle=
"black";this.navigation=document.createElement("div");this.navigation.className="ASTEROIDSYEAH";with(this.navigation.style){fontFamily="Arial,sans-serif";position="fixed";zIndex="10001";right=bottom="10px";textAlign="right"}this.navigation.innerHTML="(click anywhere to exit/press esc to quit) ";this.gameContainer.appendChild(this.navigation);this.points=document.createElement("span");this.points.style.font="28pt Arial, sans-serif";this.points.style.fontWeight="bold";this.points.className="ASTEROIDSYEAH";
this.navigation.appendChild(this.points);z();this.debug=document.createElement("span");this.debug.className="ASTEROIDSYEAH";this.debug.innerHTML="";this.navigation.appendChild(this.debug);document.body.appendChild(this.gameContainer);if(typeof G_vmlCanvasManager!="undefined")for(var O=this.canvas.getElementsByTagName("*"),I=0,J;J=O[I];I++)p(J,"ASTEROIDSYEAH");var C=function(a){a=a||window.event;e.keysPressed[a.keyCode]=true;switch(a.keyCode){case d(" "):e.firedAt=1;break}if(l([d("up"),d("down"),d("right"),
d("left"),d(" "),d("B"),d("W"),d("A"),d("S"),d("D")],a.keyCode)!=-1){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();a.returnValue=false;a.cancelBubble=true;return false}};o(document,"keydown",C);var D=function(a){a=a||window.event;if(l([d("up"),d("down"),d("right"),d("left"),d(" "),d("W"),d("A"),d("S"),d("D")],a.keyCode||a.which)!=-1){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();a.returnValue=false;a.cancelBubble=true;return false}};o(document,
"keypress",D);var E=function(a){a=a||window.event;e.keysPressed[a.keyCode]=false;if(l([d("up"),d("down"),d("right"),d("left"),d(" "),d("B"),d("W"),d("A"),d("S"),d("D")],a.keyCode)!=-1){a.preventDefault&&a.preventDefault();a.stopPropagation&&a.stopPropagation();a.returnValue=false;a.cancelBubble=true;return false}};o(document,"keyup",E);this.ctx.clear=function(){this.clearRect(0,0,k,j)};this.ctx.clear();this.ctx.drawLine=function(a,b,c,g){this.beginPath();this.moveTo(a,b);this.lineTo(c,g);this.closePath();
this.stroke()};this.ctx.drawRect=function(a){var b=this.strokeStyle;this.strokeStyle="red";this.strokeRect(a.x,a.y,a.width,a.height);this.strokeStyle=b};this.ctx.drawLineFromLine=function(a){var b=this.strokeStyle;this.strokeStyle="green";this.drawLine(a.p1.x,a.p1.y,a.p2.x,a.p2.y);this.strokeStyle=b};this.ctx.tracePoly=function(a){this.beginPath();this.moveTo(a[0][0],a[0][1]);for(var b=1;b<a.length;b++)this.lineTo(a[b][0],a[b][1]);this.closePath()};this.ctx.drawPlayer=function(){this.save();this.translate(e.pos.x,
e.pos.y);this.rotate(e.dir.angle());this.tracePoly(G);this.fillStyle="white";this.fill();this.tracePoly(G);this.stroke();this.restore()};var P=Math.PI*2;this.ctx.drawBullets=function(a){for(var b=0;b<a.length;b++){this.beginPath();this.arc(a[b].pos.x,a[b].pos.y,2,0,P,true);this.closePath();this.fill()}};this.ctx.drawParticles=function(a){for(var b=this.strokeStyle,c=0;c<a.length;c++){this.strokeStyle=["red","yellow"][Math.floor(Math.random()*2+0)];this.drawLine(a[c].pos.x,a[c].pos.y,a[c].pos.x-a[c].dir.x*
10,a[c].pos.y-a[c].dir.y*10)}this.strokeStyle=b};this.ctx.drawFlames=function(a){this.save();this.translate(e.pos.x,e.pos.y);this.rotate(e.dir.angle());var b=this.strokeStyle;this.strokeStyle="red";this.tracePoly(a.r);this.stroke();this.strokeStyle="yellow";this.tracePoly(a.y);this.stroke();this.strokeStyle=b;this.restore()};y(this.pos);p(document.body,"ASTEROIDSYEAH");var N=true,K=(new Date).getTime();this.update=function(){var a=false,b=(new Date).getTime(),c=(b-K)/1E3;K=b;var g=false;if(b-this.updated.flame>
50){s();this.updated.flame=b}this.scrollPos.x=window.pageXOffset||document.documentElement.scrollLeft;this.scrollPos.y=window.pageYOffset||document.documentElement.scrollTop;if(this.keysPressed[d("up")]||this.keysPressed[d("W")]){this.vel.add(this.dir.mulNew(300*c));g=true}else this.vel.mul(0.96);if(this.keysPressed[d("left")]||this.keysPressed[d("A")]){a=true;this.dir.rotate(360*c*-1*0.0174532925)}if(this.keysPressed[d("right")]||this.keysPressed[d("D")]){a=true;this.dir.rotate(360*c*0.0174532925)}if(this.keysPressed[d(" ")]&&
b-this.firedAt>150){this.bullets.unshift({dir:this.dir.cp(),pos:this.pos.cp(),startVel:this.vel.cp(),cameAlive:b});this.firedAt=b;this.bullets.length>20&&this.bullets.pop()}if(this.keysPressed[d("B")]){if(!this.updated.enemies){v();this.updated.enemies=true}a=true;this.updated.blink.time+=c*1E3;if(this.updated.blink.time>250){this.toggleBlinkStyle();this.updated.blink.time=0}}else this.updated.enemies=false;if(this.keysPressed[d("esc")])B.apply(this);else{this.vel.len()>600&&this.vel.setLength(600);
this.pos.add(this.vel.mulNew(c));if(this.pos.x>k){window.scrollTo(this.scrollPos.x+50,this.scrollPos.y);this.pos.x=0}else if(this.pos.x<0){window.scrollTo(this.scrollPos.x-50,this.scrollPos.y);this.pos.x=k}if(this.pos.y>j){window.scrollTo(this.scrollPos.x,this.scrollPos.y+j*0.75);this.pos.y=0}else if(this.pos.y<0){window.scrollTo(this.scrollPos.x,this.scrollPos.y-j*0.75);this.pos.y=j}for(var f=this.bullets.length-1;f>=0;f--)if(b-this.bullets[f].cameAlive>2E3){this.bullets.splice(f,1);a=true}else{var h=
this.bullets[f].dir.setLengthNew(700*c).add(this.bullets[f].startVel.mulNew(c));this.bullets[f].pos.add(h);h=this.bullets[f].pos;if(h.x>k)h.x=0;else if(h.x<0)h.x=k;if(h.y>j)h.y=0;else if(h.y<0)h.y=j;h=this.bullets[f].pos.x;var Q=this.bullets[f].pos.y;e.gameContainer.style.visibility="hidden";if(h=document.elementFromPoint(h,Q)){if(h.nodeType==3)h=h.parentNode;e.gameContainer.style.visibility="visible";h=h}else{e.gameContainer.style.visibility="visible";h=false}if(h&&l(w,h.tagName.toUpperCase())==
-1&&x(h)&&h.className!="ASTEROIDSYEAH"){didKill=true;y(this.bullets[f].pos);this.dying.push(h);this.bullets.splice(f,1)}}if(this.dying.length){for(f=this.dying.length-1;f>=0;f--)try{this.dying[f].parentNode.removeChild(this.dying[f])}catch(R){}this.enemiesKilled+=this.dying.length;z();this.dying=[]}for(f=this.particles.length-1;f>=0;f--){this.particles[f].pos.add(this.particles[f].dir.mulNew(400*c*Math.random()));if(b-this.particles[f].cameAlive>1E3){this.particles.splice(f,1);a=true}}if(a||this.bullets.length!=
0||this.particles.length!=0||!this.pos.is(this.lastPos)||this.vel.len()>0){this.ctx.clear();this.ctx.drawPlayer();g&&this.ctx.drawFlames(e.flame);this.bullets.length&&this.ctx.drawBullets(this.bullets);this.particles.length&&this.ctx.drawParticles(this.particles)}this.lastPos=this.pos;setTimeout(L,1E3/H)}};var L=function(){e.update.call(e)};setTimeout(L,1E3/H)}if(window.ActiveXObject){try{var t=document.createElement("script");t.setAttribute("type","text/xaml");t.textContent='<?xml version="1.0"?><Canvas xmlns="http://schemas.microsoft.com/client/2007"></Canvas>';
document.getElementsByTagName("head")[0].appendChild(t)}catch(S){}var m=document.createElement("script");m.setAttribute("type","text/javascript");m.onreadystatechange=function(){if(m.readyState=="loaded"||m.readyState=="complete")typeof G_vmlCanvasManager!="undefined"&&new u};m.src="http://erkie.github.com/excanvas.js";document.getElementsByTagName("head")[0].appendChild(m)}else new u})();
